% vim: spell spelllang=en:
\input{preamble}

\usepackage[justification=centering]{caption}
\usepackage{subcaption}
\usepackage{graphicx}
\usepackage{enumitem}
\usepackage{lipsum}

\usepackage{siunitx}
\usepackage{hyphenat}

\usepackage{xcolor}

\definecolor{LightGray}{rgb}{0.83, 0.83, 0.83}
\definecolor{bg}{HTML}{282828}

\usepackage[newfloat]{minted}
\captionsetup[listing]{position=top}

\setminted{
style=monokai,
%frame=lines,
framesep=2mm,
baselinestretch=1.2,
breaklines,
bgcolor=bg,
fontsize=\footnotesize,
linenos
}

\renewcommand\theadfont{\bfseries}

\title{
    PAR Laboratory Assignment\\
    Lab 4: Divide and Conquer parallelism with OpenMP: Sorting
}

\author{
    par2109:
    Aleix Boné,
    Alex Herrero
}

\date{
    Spring 2019-20
}

\begin{document}

\thispagestyle{empty}
\clearpage
\setcounter{page}{-1}

\begin{titlepage}
{
    \centering
    \null
    \vfill
    {\Huge \bfseries PAR Laboratory Assignment\par}
    \vspace{3em}
    {\Large {\scshape Lab 4:} Divide and Conquer parallelism with OpenMP: Sorting \par}
    \vfill
\begin{center}
\end{center}
    \vspace{3cm}

    \vfill
    {\raggedleft \Large
        Aleix Boné\\
        Alex Herrero\\
        {\bfseries\ttfamily par2109}\\
        \vspace{4em}
        2020-05-15
        \par}
}
\end{titlepage}

\tableofcontents
\pagebreak

\section{Introduction}%
\label{sec:intro}

\subsection{Analysis with \emph{Tareador}}

\begin{listing}[H]
\inputminted[firstline=20,lastline=31]{c}{sources/multisort-tareador-leaf.c}
\inputminted[firstline=33,lastline=51]{c}{sources/multisort-tareador-leaf.c}
\caption{Calls to the tareador API added to multisort-tareador.c for the leaf task decomposition}
\label{listing:tareador_leaf}
\end{listing}

\begin{listing}[H]
\inputminted[firstline=20,lastline=31]{c}{sources/multisort-tareador-tree.c}
\inputminted[firstline=33,lastline=51]{c}{sources/multisort-tareador-tree.c}
\caption{Calls to the tareador API added to multisort-tareador.c for the tree task decomposition}
\label{listing:tareador_leaf}
\end{listing}

\begin{figure}[H]
\centering
%\includegraphics[width=0.8\textwidth]{captures/tareador-leaf.png}
\includegraphics[width=\textwidth]{dependency_graph_leaf.pdf}
\caption{Task graph for leaf decomposition}
\label{fig:tar_tasks_leaf}
\end{figure}

\begin{figure}[H]
\centering
\includegraphics[width=0.8\textwidth]{dependency_graph_tree.pdf}
\caption{Task graph for tree decomposition}
\label{fig:tar_tasks_tree}
\end{figure}

\begin{table}[H]
\centering
\begin{tabular}{lrrrrr}
\toprule
Leaf strategy & & & & & \\
\midrule
Recursion level:        & 1     & 2     & 3     & 4     & 5  \\
Tasks generated:    & 16    & 32    & 32    & 32    & 32 \\
\bottomrule
\end{tabular}

\caption{Number of tasks that are generated at each recursion level for leaf strategy} 
\label{tab:tasks_leaf}
\end{table}

\begin{table}[H]
\centering
\begin{tabular}{lrrrrrrrrrrrrrrrrr}
\toprule
Tree strategy & & & & & & & & & & & & & & & & &\\
\midrule
Recursion level:        & 1     & 2     & 3     & 4     & 5     & 6     & 7     & 8     & 9     & 10    & 11    & 12    & 13    & 14    & 15    & 16    & 17  \\
Tasks generated:    & 1     & 1     & 4     & 8     & 16    & 4     & 8     & 16    & 2     & 4     & 8     & 16    & 1     & 2     & 4     & 8    & 16 \\
\bottomrule
\end{tabular}

\caption{Number of tasks that are generated at each recursion level for tree strategy} 
\label{tab:tree_tasks-rec_level}
\end{table}

\begin{table}[H]
\centering
\begin{tabular}{llrlr}
\toprule
           & Leaf strategy &           & Tree strategy &           \\
\midrule
Processors & Exec time (ms)& Speed-up  & Exec time (ms)& Speed-up  \\
\midrule
1          & 1.263.350     & 1,0000    & 1.263.350     & 1,0000    \\
2          & 631.688       & 2,0000    & 631.692       & 1,9999    \\
4          & 315.851       & 3,9998    & 316.452       & 3,9922    \\
8          & 158.381       & 7,9767    & 158.824       & 7,9544    \\
16         & 79.788        & 15,8338   & 79.787        & 15,8340   \\
32         & 79.746        & 15,8422   & 79.744        & 15,8426   \\
64         & 79.746        & 15,8422   & 79.744        & 15,8426   \\
\bottomrule
\end{tabular}
% te parece bien una tabla así?
\caption{Table with the execution time and speed-up as predicted by \emph{Tareador}} 
\label{tab:Exec_time-Speed-up}
\end{table}


\section{Parallelization strategies}%
\label{sec:par_strats}


\begin{listing}[H]
\inputminted[firstline=32,lastline=63]{c}{sources/multisort-omp-leaf.c}
\caption{OpenMP pragmas added for leaf decomposition}
\label{listing:omp_leaf}
\end{listing}

\begin{listing}[H]
\inputminted[firstline=32,lastline=74]{c}{sources/multisort-omp-tree.c}
\caption{OpenMP pragmas added for tree decomposition}
\label{listing:omp_tree}
\end{listing}

\begin{listing}[H]
\inputminted[firstline=32,lastline=74]{c}{sources/multisort-omp-tree-cutoff.c}
\caption{OpenMP pragmas added for tree decomposition with cutoff}
\label{listing:omp_tree_cutoff}
\end{listing}

\section{Performance evaluation}%
\label{sec:perf_eval}

\section{Conclusions}%
\label{sec:conclusions}

\end{document}
